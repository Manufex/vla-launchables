# Minimal docker-compose for smolvla model
# Based on common/docker-compose.base.yml - override any settings here if needed
services:
  smolvla:
    build:
      context: ../..
      dockerfile: common/Dockerfile

    network_mode: "host"
    runtime: nvidia

    environment:
      ENV: ${ENV:-brev}
      NVIDIA_VISIBLE_DEVICES: all
      NVIDIA_DRIVER_CAPABILITIES: compute,utility
      HF_HUB_ENABLE_HF_TRANSFER: "1"
      TOKENIZERS_PARALLELISM: "false"
      POLICY_TYPE: ${POLICY_TYPE:-smolvla}
      DATASET_REPO_ID: ${DATASET_REPO_ID:-Zasha01/cube_transfer_final}
      OUTPUT_DIR: ${OUTPUT_DIR:-/workspace/outputs/smolvla}
      JOB_NAME: ${JOB_NAME:-smolvla_cube_transfer_final}
      STEPS: ${STEPS:-3000}
      BATCH_SIZE: ${BATCH_SIZE:-8}
      WANDB_PROJECT: ${WANDB_PROJECT:-vla-train-lab}
      WANDB_SILENT: "true"

    volumes:
      - ../../:/workspace
      - hf-cache:/root/.cache/huggingface
      - torch-cache:/root/.cache/torch
      - pip-cache:/root/.cache/pip
      - wandb-cache:/root/.local/share/wandb

    working_dir: /workspace
    shm_size: "16gb"
    stdin_open: true
    tty: true

volumes:
  hf-cache:
  torch-cache:
  pip-cache:
  wandb-cache:

